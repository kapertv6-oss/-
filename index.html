<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Чат с ИИ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-family: Arial, sans-serif;
    background: #0b0d14;
    color: #f2f2f2;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
    height: 100vh;
    margin: 0;
}
#chatWindow {
    background: #161a2a;
    border: 2px solid #ff4d6d;
    border-radius: 12px;
    width: 100%;
    max-width: 500px;
    height: 400px;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 10px;
}
.chat-message {
    padding: 8px 12px;
    margin: 6px 0;
    border-radius: 12px;
    max-width: 80%;
    word-wrap: break-word;
}
.user-msg {
    background: #ff4d6d;
    align-self: flex-end;
}
.bot-msg {
    background: #161a2a;
    border: 1px solid #ff4d6d;
    align-self: flex-start;
}
input, button {
    padding: 10px;
    font-size: 16px;
    border-radius: 12px;
    border: none;
}
input {
    width: 300px;
    margin-right: 10px;
}
button {
    background: #ff4d6d;
    color: white;
    cursor: pointer;
}
</style>
</head>
<body>

<h2>Чат с ИИ</h2>
<div id="chatWindow"></div>
<div>
    <input id="userMessage" type="text" placeholder="Напиши сообщение...">
    <button onclick="sendMessage()">Отправить</button>
</div>

<script>
let activeChar = "Алукард"; // Можешь сменить на любого персонажа

function sendMessage(){
    const msgInput = document.getElementById("userMessage");
    const msg = msgInput.value.trim();
    if(!msg) return;

    const chatWin = document.getElementById("chatWindow");

    // Добавляем сообщение пользователя
    const userBlock = document.createElement("div");
    userBlock.className = "chat-message user-msg";
    userBlock.textContent = msg;
    chatWin.appendChild(userBlock);
    chatWin.scrollTop = chatWin.scrollHeight;

    msgInput.value = "";

    // Отправка на сервер ИИ через ngrok
    fetch("https://shelba-hardenable-bell.ngrok-free.dev/ask", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
            message: msg,
            character: activeChar,
            description: "Древний бессмертный вампир с невероятной силой и мистическими способностями."
        })
    })
    .then(res => res.json())
    .then(data => {
        const botReply = data.answer || "(ИИ временно недоступен)";
        const botBlock = document.createElement("div");
        botBlock.className = "chat-message bot-msg";
        botBlock.textContent = botReply;
        chatWin.appendChild(botBlock);
        chatWin.scrollTop = chatWin.scrollHeight;
    })
    .catch(() => {
        const botBlock = document.createElement("div");
        botBlock.className = "chat-message bot-msg";
        botBlock.textContent = "(Ошибка соединения с ИИ)";
        chatWin.appendChild(botBlock);
        chatWin.scrollTop = chatWin.scrollHeight;
    });
}
</script>

</body>
</html>
